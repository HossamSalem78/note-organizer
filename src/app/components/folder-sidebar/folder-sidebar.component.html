<div class="folder-sidebar">
  <div class="sidebar-header">
    <h3>Folders</h3>
    <div class="folder-dropdown-container">
      <button class="add-folder-btn" (click)="toggleAddFolder()" type="button">
        Create a Folder
      </button>
      <div class="folder-dropdown" *ngIf="showAddFolder" (click)="onFolderDropdownClick($event)">
        <div class="folder-form">
          <input 
            type="text" 
            [(ngModel)]="newFolderName"
            placeholder="Enter folder name"
            class="folder-input"
            (keyup.enter)="addFolder()"
            #folderInput
          >
          <div class="folder-actions">
            <button (click)="addFolder()" class="save-btn" [disabled]="!newFolderName.trim()">Save</button>
            <button (click)="toggleAddFolder()" class="cancel-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Loading folders...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadFolders()">Retry</button>
  </div>

  <!-- Folder List -->
  <div class="folder-list">
    <div 
      class="folder-item all-notes"
      [class.active]="selectedFolderId === null"
      (click)="selectFolder(null)"
    >
      <fa-icon [icon]="faFolder" class="folder-icon"></fa-icon>
      <span class="folder-name">All Notes</span>
    </div>

    <div 
      *ngFor="let folder of folders" 
      class="folder-item"
      [class.active]="selectedFolderId === folder.id"
      (click)="selectFolder(folder.id)"
    >
      <fa-icon [icon]="faFolder" class="folder-icon"></fa-icon>
      
      <!-- Show input when editing, span when not editing -->
      <div class="folder-name-container">
        <input 
          *ngIf="editingFolderId === folder.id"
          type="text"
          [(ngModel)]="editingFolderName"
          class="folder-name-input"
          [attr.data-folder-id]="folder.id"
          (keydown)="onFolderNameKeyDown($event, folder)"
          (blur)="saveFolderName(folder)"
          maxlength="50"
        >
        <span 
          *ngIf="editingFolderId !== folder.id"
          class="folder-name"
          (dblclick)="startEditingFolder(folder, $event)"
          title="Double-click to rename"
        >
          {{ folder.name }}
        </span>
      </div>
      
      <button 
        class="delete-folder-btn" 
        (click)="deleteFolder(folder.id)"
        type="button"
        title="Delete folder"
      >
        <fa-icon [icon]="faTrashAlt"></fa-icon>
      </button>
    </div>
  </div>

  <div *ngIf="!loading && !error && folders.length === 0" class="empty-folders">
    <p>No folders yet</p>
  </div>
</div>

<!-- Delete Folder Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirmationModal" (click)="closeDeleteConfirmationModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Delete {{ folderToDelete?.name }}</h2>
      <button class="close-btn" (click)="closeDeleteConfirmationModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="confirmation-content">
        <div class="confirmation-icon">
          <fa-icon [icon]="faExclamationTriangle"></fa-icon>
        </div>
        <div class="confirmation-text">
          <p>Are you sure you want to delete this folder?</p>
          <p class="warning-text">All notes in this folder will be moved to "All Notes".</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button 
        class="cancel-btn" 
        (click)="closeDeleteConfirmationModal()"
        [disabled]="deletingFolder"
      >
        Cancel
      </button>
      <button 
        class="delete-btn" 
        (click)="confirmDeleteFolder()"
        [disabled]="deletingFolder"
      >
        {{ deletingFolder ? 'Deleting...' : 'Delete Folder' }}
      </button>
    </div>
  </div>
</div> 